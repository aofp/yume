# Visual Architecture and Data Flow Guide

## Complete System Architecture Comparison

### Current Architecture (BROKEN)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         YURUCODE CURRENT                             â”‚
â”‚                      âš ï¸ CAUSES FREEZES âš ï¸                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                   FRONTEND (React)                    â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚  â”‚  â”‚   Zustand   â”‚  â”‚  Socket.IO  â”‚  â”‚   UI/Chat   â”‚  â”‚          â”‚
â”‚  â”‚  â”‚    Store    â”‚â—„â”€â”¤   Client    â”‚â—„â”€â”¤  Component  â”‚  â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â”‚                                      â”‚
â”‚                     Socket Connection                               â”‚
â”‚                       Port 60000-61000                              â”‚
â”‚                              â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                  TAURI MAIN PROCESS                   â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚
â”‚  â”‚  â”‚         EMBEDDED JS SERVER (3,500 lines)     â”‚    â”‚          â”‚
â”‚  â”‚  â”‚                                               â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  Problems:                                    â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ 2-hour hardcoded timeout â±ï¸                â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ 50MB buffer overflow ğŸ’¥                    â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Synchronous JSON parsing ğŸ”’               â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ WebSocket 10-min timeout ğŸ”Œ               â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ 30-second stall detection âš ï¸              â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Memory leaks to 4GB ğŸ“ˆ                     â”‚    â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â”‚                                              â”‚
â”‚            child_process.spawn()                                    â”‚
â”‚                      â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                    CLAUDE CLI                        â”‚          â”‚
â”‚  â”‚         Killed after 2 hours regardless ğŸ’€           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New Architecture (FIXED)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          YURUCODE NEW                                â”‚
â”‚                      âœ… NEVER FREEZES âœ…                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                   FRONTEND (React)                    â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚  â”‚  â”‚   Zustand   â”‚  â”‚    Tauri    â”‚  â”‚   UI/Chat   â”‚  â”‚          â”‚
â”‚  â”‚  â”‚    Store    â”‚â—„â”€â”¤   Events    â”‚â—„â”€â”¤  Component  â”‚  â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â”‚                                      â”‚
â”‚                     invoke() / listen()                             â”‚
â”‚                         (Direct IPC)                                â”‚
â”‚                              â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                  TAURI RUST BACKEND                   â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚
â”‚  â”‚  â”‚            Direct CLI Spawning                â”‚    â”‚          â”‚
â”‚  â”‚  â”‚                                               â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  Benefits:                                    â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ No timeouts (runs forever) â™¾ï¸              â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Stream processing (250MB max) ğŸ“Š           â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Async everything ğŸš€                        â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ ProcessRegistry prevents orphans ğŸ›¡ï¸        â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Platform-specific optimizations âš¡         â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  â€¢ Direct binary execution ğŸ¯                 â”‚    â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â”‚                                              â”‚
â”‚            tokio::process::Command                                  â”‚
â”‚                      â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                    CLAUDE CLI                        â”‚          â”‚
â”‚  â”‚             Runs as long as needed âœ…                â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Complete Data Flow Diagram

### Message Send Flow
```
USER TYPES MESSAGE
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React TextArea  â”‚
â”‚   (ClaudeChat)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Session   â”‚
â”‚   - Has ID?      â”‚â”€â”€â”€Noâ”€â”€â†’ Create New Session
â”‚   - Streaming?   â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
         â”‚Yes                â”‚
         â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       invoke('send_message')      â”‚
â”‚  {                                â”‚
â”‚    sessionId: string,             â”‚
â”‚    prompt: string,                â”‚
â”‚    model: string,                 â”‚
â”‚    resumeSession?: string         â”‚
â”‚  }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      TAURI COMMAND HANDLER        â”‚
â”‚   #[tauri::command]               â”‚
â”‚   async fn send_message(...)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SPAWN CLAUDE PROCESS          â”‚
â”‚                                   â”‚
â”‚  1. find_claude_binary()          â”‚
â”‚  2. Create Command                â”‚
â”‚  3. Set arguments (ORDER!)        â”‚
â”‚  4. Spawn process                 â”‚
â”‚  5. Get PID                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      REGISTER IN REGISTRY         â”‚
â”‚                                   â”‚
â”‚  CRITICAL: Must happen            â”‚
â”‚  IMMEDIATELY after spawn          â”‚
â”‚  before ANY async operations      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    EXTRACT SESSION ID (500ms)     â”‚
â”‚                                   â”‚
â”‚  Read stdout for init message:    â”‚
â”‚  {"type":"system",                â”‚
â”‚   "subtype":"init",               â”‚
â”‚   "session_id":"26_char_id"}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     UPDATE REGISTRY WITH ID       â”‚
â”‚                                   â”‚
â”‚  Map session_id â†’ run_id          â”‚
â”‚  Map session_id â†’ PID             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      START STREAM PARSING         â”‚
â”‚                                   â”‚
â”‚  while let line = readline() {    â”‚
â”‚    parse_json_line(line)          â”‚
â”‚    emit_to_frontend(data)         â”‚
â”‚  }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        EMIT TAURI EVENTS          â”‚
â”‚                                   â”‚
â”‚  â€¢ claude-message-{session}       â”‚
â”‚  â€¢ claude-tokens-{session}        â”‚
â”‚  â€¢ claude-thinking-{session}      â”‚
â”‚  â€¢ claude-complete-{session}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FRONTEND LISTENERS           â”‚
â”‚                                   â”‚
â”‚  listen('claude-message-X', ...)  â”‚
â”‚  listen('claude-tokens-X', ...)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        UPDATE ZUSTAND STORE       â”‚
â”‚                                   â”‚
â”‚  â€¢ Add message to session         â”‚
â”‚  â€¢ Accumulate tokens (+=)         â”‚
â”‚  â€¢ Update streaming flag          â”‚
â”‚  â€¢ Trigger UI re-render           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Session Lifecycle State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CREATED   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    User sends message
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚INITIALIZING â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                   Extract session ID
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”€â”€â”€â–ºâ”‚  THINKING   â”‚â—„â”€â”€â”€â”€â”€â”€â”
            â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
            â”‚              â”‚              â”‚
            â”‚       First token arrives   â”‚
            â”‚              â”‚              â”‚
            â”‚              â–¼              â”‚
            â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
            â”‚       â”‚  STREAMING  â”‚       â”‚
            â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
            â”‚              â”‚              â”‚
            â”‚         $ terminator        â”‚
            â”‚              â”‚              â”‚
            â”‚              â–¼              â”‚
            â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¤    IDLE     â”œâ”€â”€â”€â”€â”€â”€â”€â”˜
           New msg  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  New msg
                           â”‚
                        User closes
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  COMPLETED  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Error States:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ERROR   â”‚  â”‚ INTERRUPTED  â”‚  â”‚  TIMEOUT   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ProcessRegistry Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ProcessRegistry                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         HashMap<RunId, ProcessHandle>         â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  RunId â”‚ ProcessHandle                        â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚     â”‚
â”‚  â”‚    1   â”‚ { pid: 1234, session: "abc...",     â”‚     â”‚
â”‚  â”‚        â”‚   child: Child, start: time }        â”‚     â”‚
â”‚  â”‚    2   â”‚ { pid: 5678, session: "def...",     â”‚     â”‚
â”‚  â”‚        â”‚   child: Child, start: time }        â”‚     â”‚
â”‚  â”‚    3   â”‚ { pid: 9012, session: "ghi...",     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      HashMap<SessionId, RunId>                â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  SessionId (26 char) â”‚ RunId                 â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€                â”‚     â”‚
â”‚  â”‚  "abc...xyz"         â”‚ 1                     â”‚     â”‚
â”‚  â”‚  "def...uvw"         â”‚ 2                     â”‚     â”‚
â”‚  â”‚  "ghi...rst"         â”‚ 3                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         HashMap<PID, RunId>                   â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  PID  â”‚ RunId                                 â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€                                â”‚     â”‚
â”‚  â”‚  1234 â”‚ 1                                     â”‚     â”‚
â”‚  â”‚  5678 â”‚ 2                                     â”‚     â”‚
â”‚  â”‚  9012 â”‚ 3                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  Methods:                                              â”‚
â”‚  â€¢ register_process(session_id, child) â†’ run_id        â”‚
â”‚  â€¢ kill_process(run_id) â†’ Result                       â”‚
â”‚  â€¢ kill_by_session(session_id) â†’ Result                â”‚
â”‚  â€¢ cleanup_orphans() â†’ usize                           â”‚
â”‚                                                         â”‚
â”‚  Drop Trait: Automatically kills all processes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Critical Argument Ordering

```
CORRECT ORDER (MUST BE EXACT):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚  claude                                                  â”‚
â”‚    --resume SESSION_ID          â† 1. Resume (if needed) â”‚
â”‚    --prompt "text"              â† 2. Prompt or stdin    â”‚
â”‚    --model MODEL_NAME           â† 3. Model (optional)   â”‚
â”‚    --output-format stream-json  â† 4. Output format      â”‚
â”‚    --verbose                    â† 5. Verbose mode       â”‚
â”‚    --print                      â† 6. CRITICAL! Never omitâ”‚
â”‚    --dangerously-skip-perms     â† 7. macOS only        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WRONG ORDER (WILL FAIL):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚  claude                                                  â”‚
â”‚    --prompt "text"              â† âŒ Prompt before resumeâ”‚
â”‚    --resume SESSION_ID          â† âŒ Resume ignored!     â”‚
â”‚    --output-format stream-json                          â”‚
â”‚    --model MODEL_NAME                                   â”‚
â”‚    # Missing --print            â† âŒ Will hang forever!  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Memory Management Comparison

### Current (Broken) - Accumulation Pattern
```
Start: 400MB
â”‚
â”œâ”€â–º 5 min:   600MB  â†—ï¸ Growing
â”œâ”€â–º 10 min:  900MB  â†—ï¸ Growing
â”œâ”€â–º 30 min:  1.5GB  â†—ï¸ Growing
â”œâ”€â–º 1 hour:  2.5GB  â†—ï¸ Growing
â”œâ”€â–º 2 hours: 4GB+   ğŸ’¥ CRASH or KILLED

Buffer accumulation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ buffer += chunk                 â”‚ â† Grows unbounded
â”‚ buffer += chunk                 â”‚
â”‚ buffer += chunk                 â”‚
â”‚ ...                             â”‚
â”‚ buffer = "50MB+ of text"        â”‚ â† Memory explosion
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New (Fixed) - Streaming Pattern
```
Start: 250MB
â”‚
â”œâ”€â–º 5 min:   250MB  â”€ Constant
â”œâ”€â–º 10 min:  250MB  â”€ Constant
â”œâ”€â–º 30 min:  250MB  â”€ Constant
â”œâ”€â–º 1 hour:  250MB  â”€ Constant
â”œâ”€â–º 2 hours: 250MB  â”€ Constant
â”œâ”€â–º Forever: 250MB  âœ… Stable

Stream processing:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ read line (8KB buffer)          â”‚
â”‚ process line                    â”‚
â”‚ buffer.clear()  â† Key!          â”‚
â”‚ read line (reuse buffer)        â”‚
â”‚ process line                    â”‚
â”‚ buffer.clear()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Platform-Specific Process Termination

### macOS/Linux - Graceful Shutdown
```
        SIGTERM
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Process   â”‚
    â”‚   Running   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      Wait 2 seconds
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Still running?â”‚â”€â”€â”€Noâ”€â”€â†’ âœ… Clean exit
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚Yes
           â–¼
        SIGKILL
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Process   â”‚
    â”‚  Terminated â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Windows - Force Termination
```
     taskkill /F
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Process   â”‚
    â”‚  Terminated â”‚
    â”‚ (Immediate) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
No graceful shutdown
Always forceful
```

## Session File Structure

```
~/.claude/projects/
â”‚
â”œâ”€â”€ users_john_project1/
â”‚   â”œâ”€â”€ abc123def456ghi789jkl012mno.jsonl  â† Session 1
â”‚   â”œâ”€â”€ xyz789uvw456rst123opq678mno.jsonl  â† Session 2
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ users_jane_project2/
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ [encoded_project_path]/
    â””â”€â”€ [session_id].jsonl

Each JSONL file:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Line 1: {"type":"system","subtype":"init",...}    â”‚
â”‚ Line 2: {"type":"message","role":"user",...}      â”‚
â”‚ Line 3: {"type":"message","role":"assistant",...} â”‚
â”‚ Line 4: {"type":"token_usage",...}                â”‚
â”‚ ...                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Token Flow and Accumulation

```
Stream JSON from Claude:
    â”‚
    â–¼
{"type":"token_usage",
 "input_tokens":100,      â”€â”
 "output_tokens":50,       â”‚
 "cache_read_tokens":10,   â”‚ Extract
 "cache_creation_tokens":5}â”€â”˜
    â”‚
    â–¼
Process in Rust:
    â”‚
    â”œâ”€â–º session.input_tokens += 100     â† Accumulate!
    â”œâ”€â–º session.output_tokens += 50     â† Accumulate!
    â”œâ”€â–º session.cache_read += 10        â† Accumulate!
    â””â”€â–º session.cache_creation += 5     â† Accumulate!
    â”‚
    â–¼
Emit to Frontend:
    â”‚
    â–¼
Frontend Store Update:
    â”‚
    â”œâ”€â–º analytics.tokens.input += 100   â† Accumulate!
    â”œâ”€â–º analytics.tokens.output += 50   â† Accumulate!
    â””â”€â–º analytics.tokens.total = 
          input + output                 â† Recalculate!

âŒ NEVER DO THIS:
analytics.tokens.total = 50  â† Replaces instead of accumulating
```

## Error Recovery Flow

```
                 Error Occurs
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼
 Session Not    Process       Binary Not
   Found         Crashed         Found
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
 Create New    Kill & Restart  Search Paths
   Session       Process          â”‚
        â”‚             â”‚             â–¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â–º Find Alternative
                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                              â–¼           â–¼
                          Found       Not Found
                              â”‚           â”‚
                              â–¼           â–¼
                          Continue   Show Error
                                    Guide Install
```

## Title Generation Flow

```
First User Message
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Spawn Separate   â”‚
â”‚ Claude Process   â”‚
â”‚ (Sonnet model)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send Prompt:     â”‚
â”‚ "Generate title  â”‚
â”‚  for: {msg}"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    5 sec timeout
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
 Success   Timeout
    â”‚         â”‚
    â–¼         â–¼
 Use Title  Use First
            3 Words
```

## Complete Implementation Timeline

```
Week 1: Foundation
â”‚
â”œâ”€ Day 1-2: ProcessRegistry
â”‚  â””â”€ Copy from claudia
â”‚  â””â”€ Add Drop trait
â”‚  â””â”€ Test cleanup
â”‚
â”œâ”€ Day 3-4: Binary Detection  
â”‚  â””â”€ Platform paths
â”‚  â””â”€ WSL support
â”‚  â””â”€ Fallback chains
â”‚
â””â”€ Day 5: Session Management
   â””â”€ ID extraction
   â””â”€ Resume logic
   â””â”€ Storage

Week 2: Core Implementation
â”‚
â”œâ”€ Day 6-7: CLI Spawning
â”‚  â””â”€ Argument order
â”‚  â””â”€ Platform flags
â”‚  â””â”€ Stdin handling
â”‚
â”œâ”€ Day 8-9: Stream Parser
â”‚  â””â”€ JSON parsing
â”‚  â””â”€ Token extraction
â”‚  â””â”€ Error handling
â”‚
â””â”€ Day 10: Title Generation
   â””â”€ Async spawning
   â””â”€ Timeout logic
   â””â”€ Fallback

Week 3: Frontend Migration
â”‚
â”œâ”€ Day 11-12: Remove Socket.IO
â”‚  â””â”€ Delete deps
â”‚  â””â”€ Clean handlers
â”‚  â””â”€ Remove timers
â”‚
â””â”€ Day 13-14: Add Tauri
   â””â”€ Invoke commands
   â””â”€ Event listeners
   â””â”€ Store updates

Week 4: Testing & Release
â”‚
â”œâ”€ Day 15-16: Integration Tests
â”‚  â””â”€ Long tasks
â”‚  â””â”€ Memory tests
â”‚  â””â”€ Process cleanup
â”‚
â”œâ”€ Day 17-18: Platform Tests
â”‚  â””â”€ macOS (Intel/M1)
â”‚  â””â”€ Windows (10/11)
â”‚  â””â”€ WSL (1/2)
â”‚
â””â”€ Day 19-20: Polish & Release
   â””â”€ Documentation
   â””â”€ Release notes
   â””â”€ Distribution
```

## Success Metrics Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BEFORE â†’ AFTER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  5-min tasks:    85% â”€â”€â”€â”€â”€â”€â”€â”€â–º 100% âœ…                  â”‚
â”‚  30-min tasks:   35% â”€â”€â”€â”€â”€â”€â”€â”€â–º 100% âœ…                  â”‚
â”‚  2-hour tasks:    0% â”€â”€â”€â”€â”€â”€â”€â”€â–º 100% âœ…                  â”‚
â”‚                                                          â”‚
â”‚  Memory:      400MB-4GB â”€â”€â”€â”€â”€â–º 250MB constant âœ…        â”‚
â”‚  CPU:         25-40% â”€â”€â”€â”€â”€â”€â”€â”€â–º <15% âœ…                  â”‚
â”‚  Latency:     500ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º <50ms âœ…                 â”‚
â”‚                                                          â”‚
â”‚  Process cleanup: 60% â”€â”€â”€â”€â”€â”€â”€â–º 100% âœ…                  â”‚
â”‚  Session resume:  âŒ Read-only â–º âœ… Fully editable      â”‚
â”‚  Title gen:       70% success â–º 100% success âœ…         â”‚
â”‚                                                          â”‚
â”‚  Code:        3,500 lines â”€â”€â”€â–º 800 lines âœ…             â”‚
â”‚  Dependencies: Socket.IO â”€â”€â”€â”€â–º None âœ…                  â”‚
â”‚  Architecture: 3-layer â”€â”€â”€â”€â”€â”€â–º 2-layer âœ…               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Conclusion

These visual diagrams show the complete transformation from the broken embedded server architecture to the robust direct CLI spawning approach. The key improvements:

1. **Elimination of all timeout mechanisms** - Processes run indefinitely
2. **Stream processing instead of accumulation** - Constant memory usage
3. **Direct IPC instead of Socket.IO** - Lower latency, fewer failures
4. **ProcessRegistry for lifecycle management** - No orphaned processes
5. **Proper session resumption** - No more read-only restrictions

Following these architectures ensures a reliable, performant implementation that works identically on all platforms.